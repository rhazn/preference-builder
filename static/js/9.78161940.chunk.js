(this["webpackJsonppreference-builder"]=this["webpackJsonppreference-builder"]||[]).push([[9],{34:function(e,r,t){"use strict";t.r(r),t.d(r,"world_preference_component",(function(){return d}));var n=t(18),a=t(1),i=t(2),s=t(3),o=t(16),l=function(){function e(r,t){Object(i.a)(this,e),this.signature=r,this.assignment=t}return Object(s.a)(e,[{key:"toJson",value:function(){return JSON.stringify(Object(a.a)(this.assignment))}},{key:"toBinary",value:function(){var e=this.signature.size,r=new ArrayBuffer(u.getMinimalByteSignatureSize(e));return u.getMinimalViewForSignatureSize(e,r)[0]=this.getWorldNumber(),r}},{key:"getWorldNumber",value:function(){var e=this;return Object(a.a)(this.signature).reduce((function(r,t,n){return r+(e.assignment.has(t)?Math.pow(2,e.signature.size-1-n):0)}),0)}}]),e}(),u=function(){function e(r){Object(i.a)(this,e),this.signature=r}return Object(s.a)(e,[{key:"fromJson",value:function(e){var r=JSON.parse(e);return new l(this.signature,new Set(r))}},{key:"fromBinary",value:function(r){var t=e.getMinimalViewForSignatureSize(this.signature.size,r);return e.worldFromNumber(this.signature,t[0])}}],[{key:"worldFromNumber",value:function(e,r){var t=Object(a.a)(r.toString(2).padStart(e.size,"0")).reduce((function(r,t,n){return r.concat("1"===t?Object(a.a)(e)[n]:[])}),[]);return new l(e,new Set(t))}},{key:"getMinimalViewForSignatureSize",value:function(e,r){return e<=8?new Uint8Array(r):e<=16?new Uint16Array(r):new Uint32Array(r)}},{key:"getMinimalByteSignatureSize",value:function(e){return e<=8?Uint8Array.BYTES_PER_ELEMENT:e<=16?Uint16Array.BYTES_PER_ELEMENT:Uint32Array.BYTES_PER_ELEMENT}}]),e}(),c=function(){function e(r){Object(i.a)(this,e),this.data=r}return Object(s.a)(e,[{key:"toJson",value:function(){return JSON.stringify(this.data.map((function(e){return e.map((function(e){return Object(a.a)(e.assignment)}))})))}},{key:"toBinary",value:function(){var e=this.data.reduce((function(e,r){return e+r.length}),0),r=this.data.reduce((function(e,r){return e+(r.length>0?1:0)}),0);if(0===r)return new ArrayBuffer(0);var t=this.data[0][0].signature.size,n=new ArrayBuffer(Uint8Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT+r*(2*Uint32Array.BYTES_PER_ELEMENT)+e*u.getMinimalByteSignatureSize(t)),a=new DataView(n);a.setUint8(0,1),a.setUint32(Uint8Array.BYTES_PER_ELEMENT,t);for(var i=0,s=0,o=0;o<this.data.length;o++){var l=this.data[o];if(0!==l.length){var c=Uint8Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT+s*u.getMinimalByteSignatureSize(t)+i*Uint32Array.BYTES_PER_ELEMENT*2,d=this.data.slice(o+1,this.data.length).findIndex((function(e){return e.length>0}));a.setUint32(c,l.length),a.setUint32(c+Uint32Array.BYTES_PER_ELEMENT,-1===d?0:d);for(var E=c+2*Uint32Array.BYTES_PER_ELEMENT,f=0;f<l.length;f++){var h=l[f];switch(u.getMinimalByteSignatureSize(t)){case Uint8Array.BYTES_PER_ELEMENT:a.setUint8(E+f,h.getWorldNumber());break;case Uint16Array.BYTES_PER_ELEMENT:a.setUint16(E+f,h.getWorldNumber());break;case Uint32Array.BYTES_PER_ELEMENT:a.setUint32(E+f,h.getWorldNumber())}}s+=l.length,i+=1}}return n}},{key:"toBinaryRanklist",value:function(){if(!this.data[0])return new ArrayBuffer(0);var e=this.data[0][0].signature.size,r=Math.pow(2,e),t=new ArrayBuffer(Uint8Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT+r*Uint32Array.BYTES_PER_ELEMENT),a=new DataView(t);a.setUint8(0,1),a.setUint32(Uint8Array.BYTES_PER_ELEMENT,e);var i,s=0,o=Object(n.a)(this.data);try{for(o.s();!(i=o.n()).done;){var l,u=i.value,c=Object(n.a)(u);try{for(c.s();!(l=c.n()).done;){var d=l.value;a.setUint32(Uint8Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT+d.getWorldNumber()*Uint32Array.BYTES_PER_ELEMENT,s+1)}}catch(E){c.e(E)}finally{c.f()}s++}}catch(E){o.e(E)}finally{o.f()}return t}}]),e}(),d=function(){function e(r){Object(i.a)(this,e),Object(o.f)(this,r),this.preferenceChanged=Object(o.c)(this,"preferenceChanged",7),this.allowEmptyRows=!1,this.allowChanges=!0,this.preference=new c([]),this.internalPreference=new c([])}return Object(s.a)(e,[{key:"dragStartHandler",value:function(e){this.allowChanges&&(this.draggedWorld={rankIndex:+e.target.dataset.rank,worldIndex:+e.target.dataset.index})}},{key:"dragOverHandler",value:function(e){this.allowChanges&&(e.preventDefault(),e.stopPropagation())}},{key:"dragDropHandler",value:function(e){if(this.allowChanges){e.preventDefault(),e.stopPropagation();var r=this.draggedWorld.rankIndex,t=this.draggedWorld.worldIndex,n=this.internalPreference.data[r][t],i=Object(a.a)(this.internalPreference.data);i[r]=i[r].filter((function(e,r){return r!==t}));for(var s=0,o=e.path||e.composedPath&&e.composedPath(),l=0;l<o.length;l++){var u=o[l];if(u.dataset&&void 0!==u.dataset.rankindex){s=+u.dataset.rankindex;break}}i[s]=[].concat(Object(a.a)(i[s]),[n]),this.internalPreference=new c(this.manageEmptyRows(i)),this.emitChange()}}},{key:"updateInternalPreference",value:function(e){this.internalPreference=new c(this.manageEmptyRows(e.data))}},{key:"componentWillLoad",value:function(){this.updateInternalPreference(this.preference)}},{key:"manageEmptyRows",value:function(e){if(void 0===e||0===e.length)return this.allowEmptyRows?[[],[]]:[[]];for(var r=e.length-1;r>=0;r--)if(0!==e[r].length){e=e.slice(0,r+1);break}return e.push([]),this.allowEmptyRows&&e.push([]),this.allowEmptyRows?e:e.filter((function(r,t){return!(0===r.length&&t<e.length-1)}))}},{key:"emitChange",value:function(){this.preferenceChanged.emit(new c(this.internalPreference.data.slice(0,this.internalPreference.data.length-(this.allowEmptyRows?2:1))))}},{key:"render",value:function(){var e=this;return Object(o.d)(o.a,null,Object(o.d)("div",{class:"world-preference"},Object(o.d)("table",null,this.internalPreference.data.slice().reverse().map((function(r,t){var n=e.internalPreference.data.length-1-t;return Object(o.d)("tr",{class:"world-preference__rank","data-rankindex":n,onDragOver:function(r){return e.dragOverHandler(r)},onDrop:function(r){return e.dragDropHandler(r)}},Object(o.d)("td",{class:"world-preference__rank__number"},n),Object(o.d)("td",{class:e.allowChanges?"world-preference__rank__worlds":"preference__rank__worlds_fixed"},r.map((function(r,t){return Object(o.d)("propositional-world-component",{"data-rank":n,"data-index":t,draggable:!0,onDragStart:function(r){return e.dragStartHandler(r)},world:r})}))))})))))}}],[{key:"watchers",get:function(){return{preference:["updateInternalPreference"]}}}]),e}();d.style=":host{display:block}.world-preference table{border-collapse:collapse}.world-preference__rank{border-bottom:1px solid black}.world-preference__rank__number{border-right:1px solid black;padding:0.5rem;font-weight:700}.world-preference__rank__worlds *{display:inline-block;margin:0.5rem;cursor:pointer}.world-preference__rank__worlds_fixed *{display:inline-block;margin:0.5rem}"}}]);
//# sourceMappingURL=9.78161940.chunk.js.map