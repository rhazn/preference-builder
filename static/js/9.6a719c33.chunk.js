(this["webpackJsonppreference-builder"]=this["webpackJsonppreference-builder"]||[]).push([[9],{33:function(e,t,r){"use strict";r.r(t),r.d(t,"world_preference_component",(function(){return c}));var n=r(0),a=r(2),i=r(3),o=r(15),s=function(){function e(t,r){Object(a.a)(this,e),this.signature=t,this.assignment=r}return Object(i.a)(e,[{key:"toJson",value:function(){return JSON.stringify(Object(n.a)(this.assignment))}},{key:"toBinary",value:function(){var e=this.signature.size,t=new ArrayBuffer(u.getMinimalByteSignatureSize(e));return u.getMinimalViewForSignatureSize(e,t)[0]=this.getWorldNumber(),t}},{key:"getWorldNumber",value:function(){var e=this;return Object(n.a)(this.signature).reduce((function(t,r,n){return t+(e.assignment.has(r)?Math.pow(2,e.signature.size-1-n):0)}),0)}}]),e}(),u=function(){function e(t){Object(a.a)(this,e),this.signature=t}return Object(i.a)(e,[{key:"fromJson",value:function(e){var t=JSON.parse(e);return new s(this.signature,new Set(t))}},{key:"fromBinary",value:function(t){var r=e.getMinimalViewForSignatureSize(this.signature.size,t);return e.worldFromNumber(this.signature,r[0])}}],[{key:"worldFromNumber",value:function(e,t){var r=Object(n.a)(t.toString(2).padStart(e.size,"0")).reduce((function(t,r,a){return t.concat("1"===r?Object(n.a)(e)[a]:[])}),[]);return new s(e,new Set(r))}},{key:"getMinimalViewForSignatureSize",value:function(e,t){return e<=8?new Uint8Array(t):e<=16?new Uint16Array(t):new Uint32Array(t)}},{key:"getMinimalByteSignatureSize",value:function(e){return e<=8?Uint8Array.BYTES_PER_ELEMENT:e<=16?Uint16Array.BYTES_PER_ELEMENT:Uint32Array.BYTES_PER_ELEMENT}}]),e}(),l=function(){function e(t){Object(a.a)(this,e),this.data=t}return Object(i.a)(e,[{key:"toJson",value:function(){return JSON.stringify(this.data.map((function(e){return e.map((function(e){return Object(n.a)(e.assignment)}))})))}},{key:"toBinary",value:function(){var e=this.data.reduce((function(e,t){return e+t.length}),0),t=this.data.reduce((function(e,t){return e+(t.length>0?1:0)}),0);if(0===t)return new ArrayBuffer(0);var r=this.data[0][0].signature.size,n=new ArrayBuffer(Uint8Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT+t*(2*Uint32Array.BYTES_PER_ELEMENT)+e*u.getMinimalByteSignatureSize(r)),a=new DataView(n);a.setUint8(0,1),a.setUint32(Uint8Array.BYTES_PER_ELEMENT,r);for(var i=0,o=0,s=0;s<this.data.length;s++){var l=this.data[s];if(0!==l.length){var c=Uint8Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT+o*u.getMinimalByteSignatureSize(r)+i*Uint32Array.BYTES_PER_ELEMENT*2,d=this.data.slice(s+1,this.data.length).findIndex((function(e){return e.length>0}));a.setUint32(c,l.length),a.setUint32(c+Uint32Array.BYTES_PER_ELEMENT,-1===d?0:d);for(var f=c+2*Uint32Array.BYTES_PER_ELEMENT,h=0;h<l.length;h++){var g=l[h];switch(u.getMinimalByteSignatureSize(r)){case Uint8Array.BYTES_PER_ELEMENT:a.setUint8(f+h,g.getWorldNumber());break;case Uint16Array.BYTES_PER_ELEMENT:a.setUint16(f+h,g.getWorldNumber());break;case Uint32Array.BYTES_PER_ELEMENT:a.setUint32(f+h,g.getWorldNumber())}}o+=l.length,i+=1}}return n}}]),e}(),c=function(){function e(t){Object(a.a)(this,e),Object(o.f)(this,t),this.preferenceChanged=Object(o.c)(this,"preferenceChanged",7),this.allowEmptyRows=!1,this.preference=new l([]),this.internalPreference=new l([])}return Object(i.a)(e,[{key:"dragStartHandler",value:function(e){this.draggedWorld={rankIndex:+e.target.dataset.rank,worldIndex:+e.target.dataset.index}}},{key:"dragOverHandler",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"dragDropHandler",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.draggedWorld.rankIndex,r=this.draggedWorld.worldIndex,a=this.internalPreference.data[t][r],i=Object(n.a)(this.internalPreference.data);i[t]=i[t].filter((function(e,t){return t!==r}));for(var o=0,s=e.path||e.composedPath&&e.composedPath(),u=0;u<s.length;u++){var c=s[u];if(c.dataset&&void 0!==c.dataset.rankindex){o=+c.dataset.rankindex;break}}i[o]=[].concat(Object(n.a)(i[o]),[a]),this.internalPreference=new l(this.manageEmptyRows(i)),this.emitChange()}},{key:"updateInternalPreference",value:function(e){this.internalPreference=new l(this.manageEmptyRows(e.data))}},{key:"componentWillLoad",value:function(){this.updateInternalPreference(this.preference)}},{key:"manageEmptyRows",value:function(e){if(void 0===e||0===e.length)return this.allowEmptyRows?[[],[]]:[[]];for(var t=e.length-1;t>=0;t--)if(0!==e[t].length){e=e.slice(0,t+1);break}return e.push([]),this.allowEmptyRows&&e.push([]),this.allowEmptyRows?e:e.filter((function(t,r){return!(0===t.length&&r<e.length-1)}))}},{key:"emitChange",value:function(){this.preferenceChanged.emit(new l(this.internalPreference.data.slice(0,this.internalPreference.data.length-(this.allowEmptyRows?2:1))))}},{key:"render",value:function(){var e=this;return Object(o.d)(o.a,null,Object(o.d)("div",{class:"world-preference"},Object(o.d)("table",null,this.internalPreference.data.slice().reverse().map((function(t,r){var n=e.internalPreference.data.length-1-r;return Object(o.d)("tr",{class:"world-preference__rank","data-rankindex":n,onDragOver:function(t){return e.dragOverHandler(t)},onDrop:function(t){return e.dragDropHandler(t)}},Object(o.d)("td",{class:"world-preference__rank__number"},n),Object(o.d)("td",{class:"world-preference__rank__worlds"},t.map((function(t,r){return Object(o.d)("propositional-world-component",{"data-rank":n,"data-index":r,draggable:!0,onDragStart:function(t){return e.dragStartHandler(t)},world:t})}))))})))))}}],[{key:"watchers",get:function(){return{preference:["updateInternalPreference"]}}}]),e}();c.style=":host{display:block}.world-preference table{border-collapse:collapse}.world-preference__rank{border-bottom:1px solid black}.world-preference__rank__number{border-right:1px solid black;padding:0.5rem;font-weight:700}.world-preference__rank__worlds *{display:inline-block;margin:0.5rem;cursor:pointer}"}}]);
//# sourceMappingURL=9.6a719c33.chunk.js.map